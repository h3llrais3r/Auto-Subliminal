<p-table #wantedTable
         [value]="wantedItems"
         [stateKey]="tableStateKey"
         [loading]="loading"
         [autoLayout]="true"
         [rowHover]="true"
         [paginator]="true"
         [rows]="10"
         [rowsPerPageOptions]="[5,10,25,50,{showAll:'All'}]"
         [showCurrentPageReport]="true"
         [globalFilterFields]="globalFilterFields"
         [customSort]="true"
         (sortFunction)="sort($event)"
         stateStorage="local"
         currentPageReportTemplate="{first} to {last} of {totalRecords}"
         styleClass="p-datatable-sm p-datatable-gridlines p-datatable-striped p-datatable-responsive-mode">
  <ng-template pTemplate="caption">
    <div class="caption">
      <div class="p-inputgroup dropdown">
        <span class="p-inputgroup-addon">Video type</span>
        <p-dropdown [options]="videoTypes" (onChange)="wantedTable.filter($event.value, 'type', 'equals')"></p-dropdown>
      </div>
      <span class="ml-auto">
        <app-table-filter [table]="wantedTable" [tableStateKey]="tableStateKey" matchMode='contains'></app-table-filter>
      </span>
    </div>
  </ng-template>
  <ng-template pTemplate="header">
    <tr>
      <th pSortableColumn="name"><span>Name<p-sortIcon field="name"></p-sortIcon></span></th>
      <th pSortableColumn="season"><span>Season<p-sortIcon field="season"></p-sortIcon></span></th>
      <th pSortableColumn="episode"><span>Episode<p-sortIcon field="episode"></p-sortIcon></span></th>
      <th pSortableColumn="source"><span>Source<p-sortIcon field="source"></p-sortIcon></span></th>
      <th pSortableColumn="quality"><span>Quality<p-sortIcon field="quality"></p-sortIcon></span></th>
      <th pSortableColumn="codec"><span>Codec<p-sortIcon field="codec"></p-sortIcon></span></th>
      <th pSortableColumn="releaseGroup"><span>Group<p-sortIcon field="releaseGroup"></p-sortIcon></span></th>
      <th pSortableColumn="languages"><span>Lang<p-sortIcon field="languages"></p-sortIcon></span></th>
      <th pSortableColumn="timestamp"><span>Time<p-sortIcon field="timestamp"></p-sortIcon></span></th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-wantedItem>
    <tr>
      <td>
        <span class="p-column-title">Name</span>
        <span class="p-column-data">{{wantedItem.name}}</span>
        <span class="icon-group">
          <app-icon-dropdown>
            <li><span class="icon-dropdown-title">File name:</span><span>{{wantedItem.videoFileName}}</span></li>
            <li><span class="icon-dropdown-title">File size:</span><span>{{wantedItem.videoFileSize}}</span></li>
          </app-icon-dropdown>
          <ng-container *ngIf="wantedItem.isEpisode">
            <app-icon-dropdown *ngIf="!wantedItem.tvdbId" iconClass="pi pi-exclamation-triangle">
              <li>TODO: Search imdb id</li>
            </app-icon-dropdown>
            <a *ngIf="wantedItem.tvdbId" class="icon-link" [href]="getTvdbUrl(wantedItem)" target="_blank">
              <i class="fa fa-television" aria-hidden="true" title="Click to visit Tvdb"></i>
            </a>
            <a class="icon-link" (click)="openShowSettingsDialog(wantedItem)">
              <i class="fa fa-wrench" aria-hidden="true" title="Click to edit show settings"></i>
            </a>
          </ng-container>
          <ng-container *ngIf="wantedItem.isMovie">
            <app-icon-dropdown *ngIf="!wantedItem.imdbId" iconClass="pi-exclamation-triangle">
              <li>TODO: Search imdb id</li>
            </app-icon-dropdown>
            <a *ngIf="wantedItem.imdbId" class="icon-link" [href]="getImdbUrl(wantedItem)" target="_blank">
              <i class="fa fa-imdb" aria-hidden="true" title="Click to visit Imdb"></i>
            </a>
            <a class="icon-link" (click)="openMovieSettingsDialog(wantedItem)">
              <i class="fa fa-wrench" aria-hidden="true" title="Click to edit movie settings"></i>
            </a>
          </ng-container>
          <ng-container *ngIf="manualRefineEnabled">
            <a class="icon-link" (click)="openManualRefineDialog(wantedItem)">
              <i class="fa fa-pencil" aria-hidden="true" title="Manually refine item details"></i>
            </a>
          </ng-container>
        </span>
      </td>
      <td><span class="p-column-title">Season</span><span class="p-column-data">{{wantedItem.season}}</span></td>
      <td><span class="p-column-title">Episode</span><span class="p-column-data">{{wantedItem.episode}}</span></td>
      <td><span class="p-column-title">Source</span><span class="p-column-data">{{displayUpperCase(wantedItem.source)}}</span></td>
      <td><span class="p-column-title">Quality</span><span class="p-column-data">{{displayUpperCase(wantedItem.quality)}}</span></td>
      <td><span class="p-column-title">Codec</span><span class="p-column-data">{{displayUpperCase(wantedItem.codec)}}</span></td>
      <td><span class="p-column-title">Group</span><span class="p-column-data">{{displayUpperCase(wantedItem.releaseGroup)}}</span></td>
      <td><span class="p-column-title">Lang</span><span class="p-column-data"><span *ngFor="let language of wantedItem.languages" class="p-tag language mr-2">{{language}}</span></span></td>
      <td><span class="p-column-title">Time</span><span class="p-column-data">{{wantedItem.timestampFormatted}}</span></td>
    </tr>
  </ng-template>
</p-table>

<!-- Show settings dialog -->
<app-show-settings *ngIf="showShowSettings"
                   [(visible)]="showShowSettings"
                   [tvdbId]="selectedWantedItem.tvdbId"
                   [title]="selectedWantedItem.name">
</app-show-settings>

<!-- Movie settings dialog -->
<app-movie-settings *ngIf="showMovieSettings"
                    [(visible)]="showMovieSettings"
                    [imdbId]="selectedWantedItem.imdbId"
                    [title]="selectedWantedItem.name">
</app-movie-settings>

<!-- Manual refine dialog -->
<app-manual-refine *ngIf="showManualRefine"
                   [(visible)]="showManualRefine"
                   [wantedItem]="selectedWantedItem"
                   (wantedItemChange)="updateWantedItem($event)">
</app-manual-refine>
