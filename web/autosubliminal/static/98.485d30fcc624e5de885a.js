"use strict";(self.webpackChunkautosubliminal=self.webpackChunkautosubliminal||[]).push([[98],{1098:(R,h,l)=>{l.r(h),l.d(h,{LogModule:()=>k});var v=l(3273),a=l(4157),t=l(639),u=l(8002),d=l(1205),L=l(8621),b=l(1841);let m=(()=>{class e extends L.g{constructor(o){super(o),this.httpClient=o,this.URL=`${d.$0.webRoot}/api/logs`}getLogs(o){return this.httpClient.get(o?`${this.URL}/${o}`:this.URL,this.options)}clearLogs(){return this.httpClient.delete(this.URL,this.options).pipe((0,u.U)(()=>!0))}getLogCount(){return this.httpClient.get(`${this.URL}/count`,this.options).pipe((0,u.U)(o=>o.count))}}return e.\u0275fac=function(o){return new(o||e)(t.LFG(b.eN))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var f=l(1245);let T=(()=>{class e{constructor(o,n,i){this.router=o,this.logService=n,this.messageService=i}ngOnInit(){this.logService.clearLogs().subscribe(o=>{o&&this.router.navigateByUrl("/log/view")},()=>this.messageService.showErrorMessage("Unable to clear the logs!"))}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(a.F0),t.Y36(m),t.Y36(f.e))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-log-clear"]],decls:0,vars:0,template:function(o,n){},styles:[""]}),e})();var S=l(3186),c=(()=>{return(e=c||(c={})).DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR",e.CRITICAL="CRITICAL",c;var e})(),M=l(2924),w=l(2707),p=l(8583),Z=l(671),O=l(4441),C=l(3679),A=l(5102);const g=function(e){return{"d-none":e}};let y=(()=>{class e{constructor(){}ngOnInit(){this.scrollHeight=this.getScrollHeight(),this.maxScrollHeight=this.getMaxScrollHeight()}get scrollBottom(){return this.scrollHeight<this.maxScrollHeight}get scrollTop(){return this.scrollHeight>=100}onWindowScroll(){this.scrollHeight=this.getScrollHeight(),this.maxScrollHeight=this.getMaxScrollHeight()}scrollToTop(){this.scrollHeight>0&&(this.target?this.target.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"}))}scrollToBottom(){this.maxScrollHeight>0&&(this.target?this.target.scrollIntoView({block:"end",inline:"nearest",behavior:"smooth"}):window.scrollTo({top:this.maxScrollHeight,behavior:"smooth"}))}getScrollHeight(){return document.documentElement.scrollTop||document.body.scrollTop}getMaxScrollHeight(){return(document.documentElement.scrollHeight||document.body.scrollHeight)-(document.documentElement.offsetHeight||document.body.offsetHeight)}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-scroll"]],hostBindings:function(o,n){1&o&&t.NdJ("scroll",function(){return n.onWindowScroll()},!1,t.Jf7)},inputs:{target:"target"},decls:6,vars:12,consts:[[1,"scroll-icons","top"],["aria-hidden","true","title","Scroll to bottom",1,"fa","fa-arrow-circle-down","scroll-icon-bottom",3,"ngClass","click"],["aria-hidden","true","title","Scroll to top",1,"fa","fa-arrow-circle-up","scroll-icon-top",3,"ngClass","click"],[1,"scroll-icons","bottom"]],template:function(o,n){1&o&&(t.TgZ(0,"span",0),t.TgZ(1,"i",1),t.NdJ("click",function(){return n.scrollToBottom()}),t.qZA(),t.TgZ(2,"i",2),t.NdJ("click",function(){return n.scrollToTop()}),t.qZA(),t.qZA(),t.TgZ(3,"span",3),t.TgZ(4,"i",1),t.NdJ("click",function(){return n.scrollToBottom()}),t.qZA(),t.TgZ(5,"i",2),t.NdJ("click",function(){return n.scrollToTop()}),t.qZA(),t.qZA()),2&o&&(t.xp6(1),t.Q6J("ngClass",t.VKq(4,g,!n.scrollBottom)),t.xp6(1),t.Q6J("ngClass",t.VKq(6,g,!n.scrollTop)),t.xp6(2),t.Q6J("ngClass",t.VKq(8,g,!n.scrollBottom)),t.xp6(1),t.Q6J("ngClass",t.VKq(10,g,!n.scrollTop)))},directives:[p.mk],styles:[".scroll-icons[_ngcontent-%COMP%]{position:fixed;right:.25rem;font-size:1.5rem}.scroll-icons.top[_ngcontent-%COMP%]{top:4.375rem}.scroll-icons.bottom[_ngcontent-%COMP%]{bottom:1.5rem}@media screen and (max-width: 767px){.scroll-icons.bottom[_ngcontent-%COMP%]{bottom:2.5rem}}.scroll-icon-bottom[_ngcontent-%COMP%], .scroll-icon-top[_ngcontent-%COMP%]{overflow:hidden;z-index:999;cursor:pointer;background-color:var(--surface-d);color:var(--text-color);font-size:1.5rem;border-radius:.5rem;padding:.25rem}.scroll-icon-bottom[_ngcontent-%COMP%]:hover, .scroll-icon-top[_ngcontent-%COMP%]:hover{background-color:var(--text-color);color:var(--surface-d)}"]}),e})();const N=function(e){return{"p-badge-secondary":e}};function H(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"span",12),t.NdJ("click",function(){const r=t.CHM(o).$implicit;return t.oxw().getLogs(r)}),t._uU(1),t.qZA()}if(2&e){const o=s.$implicit,n=t.oxw();t.Q6J("ngClass",t.VKq(2,N,n.selectedLogNum!==o)),t.xp6(1),t.Oqu(o)}}const B=function(e){return{"p-tag-secondary":e}},J=[{path:"",redirectTo:"view",pathMatch:"full"},{path:"view",component:(()=>{class e{constructor(o,n){this.logService=o,this.messageService=n,this.LOG_MESSAGE_REGEX=/^((?<date>\d{4}\-\d{2}\-\d{2})\s(?<time>\d{2}:\d{2}:\d{2},\d{3})\s(?<loglevel>\w+))/,this.selectedLogNum=0,this.selectedLoglevel="",this.loading=!1,this.tailing=!1,this.tailingDisabled=!1,this.tailButtonLabel="Start tailing",this.tailButtonIcon="pi pi-play",this.logMessages=[]}ngOnInit(){this.loglevels=this.getLogLevels(),this.logService.getLogCount().subscribe(o=>this.logNums=Array.from(Array(o).keys()).map(n=>n+1)),this.getLogs(0)}getLogs(o){this.loading=!0,this.selectedLogNum=o,this.tailingDisabled=0!==this.selectedLogNum,this.logService.getLogs(o).subscribe(n=>{this.logMessages=n,this.loading=!1,this.handleLogTailing()},()=>this.messageService.showErrorMessage("Unable to get the logs!"))}toggleTailing(){this.tailing=!this.tailing,this.tailing?(this.tailButtonLabel="Stop tailing",this.tailButtonIcon="pi pi-pause"):(this.tailButtonLabel="Start tailing",this.tailButtonIcon="pi pi-play"),this.handleLogTailing()}get filteredLogMessages(){return this.logMessages.filter(o=>{if(this.selectedLoglevel){const n=this.LOG_MESSAGE_REGEX.exec(o);return n&&n.groups.loglevel===this.selectedLoglevel}return!0})}get logContent(){return this.filteredLogMessages.join("\n")}getLogLevels(){const o=[];return o.push({label:"ALL",value:""}),Object.entries(c).forEach(n=>o.push({label:n[0],value:n[1]})),o}createLogWebSocket(){let o="ws:";"https:"===window.location.protocol&&(o="wss:");const i={url:`${o}//${window.location.host}${d.$0.webRoot}/websocket/log`,deserializer:r=>r.data,serializer:r=>r};return(0,S.j)(i)}handleLogTailing(){this.tailing&&!this.tailingDisabled?(this.logWebsocket=this.createLogWebSocket(),this.logWebsocket.subscribe(o=>{this.logMessages.push(o)}),console.log("Log tailing enabled")):(this.logWebsocket&&this.logWebsocket.unsubscribe(),console.log("Log tailing disabled"))}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(m),t.Y36(f.e))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-log-view"]],decls:18,vars:11,consts:[[1,"container-lg"],[1,"w-100"],[1,"p-panel-title"],[1,"log-num"],[1,"p-tag","p-tag-rounded",3,"ngClass","click"],["class","p-badge",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"log-tail"],["styleClass","p-button-outlined",3,"label","icon","disabled","onClick"],[1,"log-level"],["styleClass","p-dropdown-ar","scrollHeight","300px",3,"options","ngModel","ngModelChange"],[1,"log-content"],[3,"visible"],[1,"p-badge",3,"ngClass","click"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0),t.TgZ(1,"p-panel"),t.TgZ(2,"p-header",1),t.TgZ(3,"div",2),t._uU(4,"Logfile"),t.qZA(),t.TgZ(5,"div"),t.TgZ(6,"span",3),t.TgZ(7,"span",4),t.NdJ("click",function(){return n.getLogs(0)}),t._uU(8,"current"),t.qZA(),t.YNc(9,H,2,4,"span",5),t.qZA(),t.TgZ(10,"span",6),t.TgZ(11,"p-button",7),t.NdJ("onClick",function(){return n.toggleTailing()}),t.qZA(),t.qZA(),t.TgZ(12,"span",8),t.TgZ(13,"p-dropdown",9),t.NdJ("ngModelChange",function(r){return n.selectedLoglevel=r}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(14,"pre",10),t._uU(15),t.qZA(),t.qZA(),t.qZA(),t._UZ(16,"app-loading",11),t._UZ(17,"app-scroll")),2&o&&(t.xp6(7),t.Q6J("ngClass",t.VKq(9,B,0!==n.selectedLogNum)),t.xp6(2),t.Q6J("ngForOf",n.logNums),t.xp6(2),t.Q6J("label",n.tailButtonLabel)("icon",n.tailButtonIcon)("disabled",n.tailingDisabled),t.xp6(2),t.Q6J("options",n.loglevels)("ngModel",n.selectedLoglevel),t.xp6(2),t.Oqu(n.logContent),t.xp6(1),t.Q6J("visible",n.loading))},directives:[M.s,w.h4,p.mk,p.sg,Z.zx,O.Lt,C.JJ,C.On,A.N,y],styles:[".log-num[_ngcontent-%COMP%]   .p-badge[_ngcontent-%COMP%], .log-num[_ngcontent-%COMP%]   .p-tag[_ngcontent-%COMP%]{margin-right:.5rem;cursor:pointer}.log-num[_ngcontent-%COMP%]   .p-badge[_ngcontent-%COMP%]:hover, .log-num[_ngcontent-%COMP%]   .p-tag[_ngcontent-%COMP%]:hover{-moz-filter:brightness(125%);-o-filter:brightness(125%);filter:brightness(125%)}.log-tail[_ngcontent-%COMP%]{margin-right:.5rem}.log-content[_ngcontent-%COMP%]{overflow:auto;color:var(--text-color)}"]}),e})()},{path:"clear",component:T},{path:"**",redirectTo:"view"}];let _=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[a.Bz.forChild(J)],a.Bz]}),e})(),k=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[v.m,_]]}),e})()}}]);