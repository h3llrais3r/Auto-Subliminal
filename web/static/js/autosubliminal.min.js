"use strict";var autosubliminal={types:{},settings:{},notifications:{},websockets:{},vue:{},library:{}};!function(o){o.WEB_ROOT=webRoot,o.BASE_URL=window.location.protocol+"//"+window.location.host+o.WEB_ROOT,o.DEVELOPER_MODE=!1,o.SCAN_DISK="DiskScanner",o.SCAN_LIBRARY="LibraryScanner",o.CHECK_SUB="SubChecker",o.CHECK_VERSION="VersionChecker",o.TVDB_URL="http://thetvdb.com/?tab=series&id=",o.IMDB_URL="http://www.imdb.com/title/",o.TIMESTAMP_FORMAT="%Y-%m-%d %H:%M:%S",o.DATE_FORMAT=o.TIMESTAMP_FORMAT.split(" ")[0],o.TIME_FORMAT=o.TIMESTAMP_FORMAT.split(" ")[1],o.TABLESORTER_DATE_FORMAT="yyyymmdd",o.PATH_SEPARTOR="/",o.LANGUAGES=[],o.EPISODE_TYPE="episode",o.MOVIE_TYPE="movie",o.getUrl=function(t){return o.BASE_URL+t},o.constructPlayVideoUrl=function(t,e){return"playvideo://"+t+o.PATH_SEPARTOR+e},o.convertToLanguages=function(t){for(var e=[],n=0;n<t.length;n++)for(var s=t[n],i=0;i<o.LANGUAGES.length;i++)o.LANGUAGES[i].code==s&&e.push(o.LANGUAGES[i]);return e},o.convertToLanguageCodes=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].code);return e},o.types.Settings={developerMode:null,webRoot:null,scanDisk:null,scanLibrary:null,checkSub:null,checkVersion:null,tvdbUrl:null,imdbUrl:null,timestampFormat:null,pathSeparator:null,languages:null},o.types.Notification={message:null,type:null,sticky:null},o.types.WebsocketNotification={type:o.websockets.NOTIFICATION,notification:o.types.Notification},o.types.WebsocketPageReloadEvent={type:o.websockets.EVENT,event:{type:o.websockets.PAGE_RELOAD,data:{name:null}}},o.types.WebsocketProcessStartedEvent={type:o.websockets.EVENT,event:{type:o.websockets.PROCESS_STARTED,data:o.types.Process}},o.types.WebsocketProcessFinishedEvent={type:o.websockets.EVENT,event:{type:o.websockets.PROCESS_FINISHED,data:o.types.Process}},o.types.Process={name:null,interval:null,active:null,alive:null,last_run:null,next_run:null,running:null},o.types.Show={path:null,tvdb_id:null,title:null,year:null,overview:null,poster:null,banner:null,settings:null,path_in_video_paths:null,total_subtitles_wanted:null,total_subtitles_missing:null,total_subtitles_available:null,files:null},o.types.Movie={path:null,imdb_id:null,title:null,year:null,overview:null,poster:null,settings:null,path_in_video_paths:null,total_subtitles_wanted:null,total_subtitles_missing:null,total_subtitles_available:null,files:null},o.types.SubtitleLanguage={code:null,name:null},o.settings.LOADED="SETTINGS_LOADED",o.settings.loadSettings=function(){$.get(o.getUrl("/api/settings/frontend"),function(t){if(!jQuery.isEmptyObject(t)){o.DEVELOPER_MODE=t.developerMode,o.SCAN_DISK=t.scanDisk,o.SCAN_LIBRARY=t.scanLibrary,o.CHECK_SUB=t.checkSub,o.CHECK_VERSION=t.checkVersion,o.TVDB_URL=t.tvdbUrl,o.IMDB_URL=t.imdbUrl,o.TIMESTAMP_FORMAT=t.timestampFormat,o.DATE_FORMAT=o.TIMESTAMP_FORMAT.split(" ")[0],o.TIME_FORMAT=o.TIMESTAMP_FORMAT.split(" ")[1];var e=o.DATE_FORMAT.match(/[Ymd]+/g).join("");"Ymd"==e?o.TABLESORTER_DATE_FORMAT="yyyymmdd":"mdY"==e?o.TABLESORTER_DATE_FORMAT="mmddyyyy":"dmY"==e&&(o.TABLESORTER_DATE_FORMAT="ddmmyyyy"),o.PATH_SEPARTOR=t.pathSeparator,o.LANGUAGES=t.languages,PubSub.publish(o.settings.LOADED,null)}})},o.settings.loadSettings(),o.notifications.INFO="info",o.notifications.SUCCESS="success",o.notifications.WARNING="notice",o.notifications.ERROR="error",o.notifications.stackBottomRight=new PNotify.Stack({dir1:"up",dir2:"left",firstpos1:10,firstpos2:10,spacing1:10,spacing2:10}),o.notifications.stackContext=new PNotify.Stack({dir1:"down",dir2:"right",context:document.getElementById("stickyNotificationContext")}),PNotify.defaults.stack=o.notifications.stackBottomRight,PNotify.defaults.addClass="stack-bottomright",PNotify.defaults.styling="bootstrap3",PNotify.defaults.icons="bootstrap3",PNotify.defaults.delay=5e3,PNotify.defaultModules.set(PNotifyBootstrap3,{}),PNotify.defaultModules.set(PNotifyGlyphicon,{}),PNotify.defaultModules.set(PNotifyMobile,{}),PNotify.defaultModules.set(PNotifyDesktop,{}),PNotifyDesktop.permission(),o.notifications.stackContextModules=new Map(Array.from(PNotify.defaultModules)),o.notifications.stackContextModules.delete(PNotifyDesktop),o.notifications.showNotification=function(t){var e=t.message,n=t.type;t.sticky?PNotify.alert({title:!1,text:e,textTrusted:!0,type:n,hide:!1,width:"auto",addClass:"container stack-context",stack:o.notifications.stackContext,modules:o.notifications.stackContextModules}):PNotify.alert({title:"Auto-Subliminal",text:e,textTrusted:!0,type:n})},o.websockets.EVENT="EVENT",o.websockets.NOTIFICATION="NOTIFICATION",o.websockets.PAGE_RELOAD="PAGE_RELOAD",o.websockets.PROCESS_STARTED="PROCESS_STARTED",o.websockets.PROCESS_FINISHED="PROCESS_FINISHED",o.websockets.RUN_PROCESS="RUN_PROCESS";var t="ws:";"https:"===window.location.protocol&&(t="wss:");var e=t+"//"+window.location.host+o.WEB_ROOT+"/system/websocket";o.websockets.ws=new WebSocket(e),o.websockets.ws.onmessage=function(t){var e=t.data;if(!jQuery.isEmptyObject(e)){var n=JSON.parse(e);o.websockets.handleWebsocketMessage(n)}},o.websockets.handleWebsocketMessage=function(t){t.type==o.websockets.NOTIFICATION?o.notifications.showNotification(t.notification):t.type==o.websockets.EVENT?o.websockets.handleWebsocketEvent(t.event):console.error("Unsupported message: "+t)},o.websockets.handleWebsocketEvent=function(t){var e=t.type,n=t.data;if(e==o.websockets.PAGE_RELOAD)jQuery.isEmptyObject(n)?setTimeout(function(){window.location.reload()},1e3):0<=window.location.pathname.indexOf("/"+n.name)&&setTimeout(function(){window.location.reload()},1e3);else if(e==o.websockets.PROCESS_STARTED){if(!jQuery.isEmptyObject(n)){PubSub.publish(o.websockets.PROCESS_STARTED,n);var s=$("#scanDiskNextRun"),i=$("#checkSubNextRun");n.name==o.SCAN_DISK?(s.countdown("stop"),s.text("Running...")):n.name==o.CHECK_SUB&&(i.countdown("stop"),i.text("Running..."))}}else e==o.websockets.PROCESS_FINISHED?jQuery.isEmptyObject(n)||(PubSub.publish(o.websockets.PROCESS_FINISHED,n),n.name==o.SCAN_DISK?$("#scanDiskNextRun").countdown(n.next_run):n.name==o.CHECK_SUB&&$("#checkSubNextRun").countdown(n.next_run)):console.error("Unsupported event type: "+e)},o.websockets.sendWebsocketMessage=function(t){o.websockets.ws.send(t)},o.websockets.runProcessOnServer=function(t){var e={type:o.websockets.EVENT,event:{type:o.websockets.RUN_PROCESS,data:{name:t}}};o.websockets.sendWebsocketMessage(JSON.stringify(e))},o.vue.setPosterPlaceholderUrl=function(t){t.target.src=o.getUrl("/images/poster-placeholder.jpg")},o.vue.styleProgressBar=function(s){$(".vue-simple-progress-bar").each(function(){var t=$(this),e=s;null==e&&(e=parseInt(t.css("width"))/parseInt(t.prev(".vue-simple-progress-text").css("width"))*100),e=Math.round(e);for(var n=100;0<e&&e<n;)n-=5;t.removeClass(function(t,e){return(e.match(/\bprogress-\S+/g)||[]).join(" ")}),t.addClass("progress-"+n)})},$(".navbar .nav a").on("click",function(){$(this).hasClass("run-process")||($(".navbar").find(".nav").find(".active").removeClass("active"),$(this).parent().addClass("active"))});var n="/"+location.pathname.replace(o.WEB_ROOT,"").split("/")[1]+"/";$(".navbar").find(".nav").find("a[href='"+n+"']").closest("li").addClass("active"),$(".navbar .nav a.run-process").on("click",function(t){t.preventDefault();var e=$(this).data("process-name");o.websockets.runProcessOnServer(e)}),$("input[type=checkbox][data-toggle=toggle][data-on=Enabled][data-off=Disabled]").on("change",function(){var t=$(this).parent().next("input[type=hidden]").val();t="False"==t?"True":"False",$(this).parent().next("input[type=hidden]").val(t)}),o.keepDropdownsOpen=function(){$(".dropdown .dropdown-menu.keep-open,.dropdown-menu.info-list").on("click",function(t){t.stopPropagation()})},o.keepDropdownsOpen(),o.enablePopovers=function(){$("[data-toggle=popover]").popover(),$(document).on("click",function(t){$('[data-toggle="popover"],[data-original-title]').each(function(){$(this).is(t.target)||0!==$(this).has(t.target).length||0!==$(".popover").has(t.target).length||((($(this).popover("hide").data("bs.popover")||{}).inState||{}).click=!1)})})},o.enablePopovers();var s=new Date;s.setTime($("#scanDiskNextRunTimeMs").val()),$("#scanDiskNextRun").countdown(s,function(t){"00:00:00"==t.strftime(o.TIME_FORMAT)?$(this).text("Running..."):$(this).text(t.strftime(o.TIME_FORMAT))});var i=new Date;i.setTime($("#checkSubNextRunTimeMs").val()),$("#checkSubNextRun").countdown(i,function(t){"00:00:00"==t.strftime(o.TIME_FORMAT)?$(this).text("Running..."):$(this).text(t.strftime(o.TIME_FORMAT))}),o.initMultiInputTextArea=function(t){$(t).hide();var e=$(t).val().split("\n");$(t).next("div.multi-input-fields").remove(),$(t).after('<div class="multi-input-fields"></div>');for(var n=$(t).next("div.multi-input-fields"),s=0;s<e.length;s++)$(n).append('<div class="input-group"><input type="text" class="form-control input-sm" value="'+e[s]+'"><span class="input-group-addon addon-remove"><i class="fa fa-times" aria-hidden="true"></i></span></div>');$(n).append('<div class="input-group"><input type="text" class="form-control input-sm" placeholder="New value"><span class="input-group-addon addon-add"><i class="fa fa-plus" aria-hidden="true"></i></span></div>')},o.initMultiInputTextAreas=function(){$("textarea.multi-input").each(function(){o.initMultiInputTextArea(this)})},o.initMultiInputTextAreas(),$(document).on("click",".multi-input-fields .input-group .addon-add",function(){var t=$(this).parents(".multi-input-fields").siblings(".multi-input"),e=$(t).val().split("\n"),n=$(this).siblings("input").val(),s=e.filter(function(t){return t===n});if(n&&0===s.length){var i=e.concat([n]);$(t).val(i.join("\n")),o.initMultiInputTextArea(t)}else $(this).siblings("input").val("")}),$(document).on("click",".multi-input-fields .input-group .addon-remove",function(){var t=$(this).parents(".multi-input-fields").siblings(".multi-input"),e=t.val().split("\n"),n=$(this).siblings("input").val(),s=e.filter(function(t){return t!==n});t.val(s.join("\n")),o.initMultiInputTextArea(t)})}(autosubliminal),$.postJson=function(t,e,n,s){"string"!=typeof e&&(e=JSON.stringify(e)),$.ajax({url:t,type:"post",data:e,dataType:s||"json",contentType:"application/json; charset=utf-8",success:n})},$.putJson=function(t,e,n,s){"string"!=typeof e&&(e=JSON.stringify(e)),$.ajax({url:t,type:"put",data:e,dataType:s||"json",contentType:"application/json; charset=utf-8",success:n})},$.deleteJson=function(t,e,n,s){"string"!=typeof e&&(e=JSON.stringify(e)),$.ajax({url:t,type:"delete",data:e,dataType:s||"json",contentType:"application/json; charset=utf-8",success:n})};