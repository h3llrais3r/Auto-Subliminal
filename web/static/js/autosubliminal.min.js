"use strict";var autosubliminal={types:{},settings:{},notifications:{},websockets:{},vue:{},library:{}};!function(o){o.WEB_ROOT=webRoot,o.BASE_URL=window.location.protocol+"//"+window.location.host+o.WEB_ROOT,o.DEVELOPER_MODE=!1,o.SCAN_DISK="DiskScanner",o.SCAN_LIBRARY="LibraryScanner",o.CHECK_SUB="SubChecker",o.CHECK_VERSION="VersionChecker",o.TVDB_URL="http://thetvdb.com/?tab=series&id=",o.IMDB_URL="http://www.imdb.com/title/",o.TIMESTAMP_FORMAT="%Y-%m-%d %H:%M:%S",o.DATE_FORMAT=o.TIMESTAMP_FORMAT.split(" ")[0],o.TIME_FORMAT=o.TIMESTAMP_FORMAT.split(" ")[1],o.TABLESORTER_DATE_FORMAT="yyyymmdd",o.PATH_SEPARTOR="/",o.LANGUAGES=[],o.EPISODE_TYPE="episode",o.MOVIE_TYPE="movie",o.getUrl=function(t){return o.BASE_URL+t},o.constructPlayVideoUrl=function(t,e){return"playvideo://"+t+o.PATH_SEPARTOR+e},o.convertToLanguages=function(t){for(var e=[],n=0;n<t.length;n++)for(var i=t[n],s=0;s<o.LANGUAGES.length;s++)o.LANGUAGES[s].code==i&&e.push(o.LANGUAGES[s]);return e},o.convertToLanguageCodes=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].code);return e};var t=o.types;t.Settings=function(){return{developerMode:null,webRoot:null,scanDisk:null,scanLibrary:null,checkSub:null,checkVersion:null,tvdbUrl:null,imdbUrl:null,timestampFormat:null,pathSeparator:null,languages:null}},t.Notification=function(){return{message:null,type:null,sticky:null}},t.WebsocketNotification=function(){return{type:o.websockets.NOTIFICATION,notification:t.Notification()}},t.WebsocketPageReloadEvent=function(){return{type:o.websockets.EVENT,event:{type:o.websockets.PAGE_RELOAD,data:{name:null}}}},t.WebsocketProcessStartedEvent=function(){return{type:o.websockets.EVENT,event:{type:o.websockets.PROCESS_STARTED,data:t.Process()}}},t.WebsocketProcessFinishedEvent=function(){return{type:o.websockets.EVENT,event:{type:o.websockets.PROCESS_FINISHED,data:t.Process()}}},t.Process=function(){return{name:null,interval:null,active:null,alive:null,last_run:null,next_run:null,running:null}},t.Show=function(){return{path:null,tvdb_id:null,title:null,year:null,overview:null,poster:null,banner:null,settings:null,path_in_video_paths:null,total_subtitles_wanted:null,total_subtitles_missing:null,total_subtitles_available:null,files:null}},t.Movie=function(){return{path:null,imdb_id:null,title:null,year:null,overview:null,poster:null,settings:null,path_in_video_paths:null,total_subtitles_wanted:null,total_subtitles_missing:null,total_subtitles_available:null,files:null}},t.SubtitleLanguage=function(){return{code:null,name:null}};var n=o.settings;n.LOADED="SETTINGS_LOADED",n.loadSettings=function(){$.get(o.getUrl("/api/settings/frontend"),function(t){if(!jQuery.isEmptyObject(t)){o.DEVELOPER_MODE=t.developerMode,o.SCAN_DISK=t.scanDisk,o.SCAN_LIBRARY=t.scanLibrary,o.CHECK_SUB=t.checkSub,o.CHECK_VERSION=t.checkVersion,o.TVDB_URL=t.tvdbUrl,o.IMDB_URL=t.imdbUrl,o.TIMESTAMP_FORMAT=t.timestampFormat,o.DATE_FORMAT=o.TIMESTAMP_FORMAT.split(" ")[0],o.TIME_FORMAT=o.TIMESTAMP_FORMAT.split(" ")[1];var e=o.DATE_FORMAT.match(/[Ymd]+/g).join("");"Ymd"==e?o.TABLESORTER_DATE_FORMAT="yyyymmdd":"mdY"==e?o.TABLESORTER_DATE_FORMAT="mmddyyyy":"dmY"==e&&(o.TABLESORTER_DATE_FORMAT="ddmmyyyy"),o.PATH_SEPARTOR=t.pathSeparator,o.LANGUAGES=t.languages,PubSub.publish(n.LOADED,null)}})},n.loadSettings();var i=o.notifications;i.INFO="info",i.SUCCESS="success",i.WARNING="notice",i.ERROR="error",i.stackBottomRight=new PNotify.Stack({dir1:"up",dir2:"left",firstpos1:10,firstpos2:10,spacing1:10,spacing2:10}),i.stackContext=new PNotify.Stack({dir1:"down",dir2:"right",context:document.getElementById("stickyNotificationContext")}),PNotify.defaults.stack=i.stackBottomRight,PNotify.defaults.addClass="stack-bottomright",PNotify.defaults.styling="bootstrap3",PNotify.defaults.icons="bootstrap3",PNotify.defaults.delay=5e3,PNotify.defaultModules.set(PNotifyBootstrap3,{}),PNotify.defaultModules.set(PNotifyGlyphicon,{}),PNotify.defaultModules.set(PNotifyMobile,{}),PNotify.defaultModules.set(PNotifyDesktop,{}),PNotifyDesktop.permission(),i.stackContextModules=new Map(Array.from(PNotify.defaultModules)),i.stackContextModules.delete(PNotifyDesktop),i.showNotification=function(t){var e=t.message,n=t.type;t.sticky?PNotify.alert({title:!1,text:e,textTrusted:!0,type:n,hide:!1,width:"auto",addClass:"container stack-context",stack:i.stackContext,modules:i.stackContextModules}):PNotify.alert({title:"Auto-Subliminal",text:e,textTrusted:!0,type:n})};var a=o.websockets;a.EVENT="EVENT",a.NOTIFICATION="NOTIFICATION",a.PAGE_RELOAD="PAGE_RELOAD",a.PROCESS_STARTED="PROCESS_STARTED",a.PROCESS_FINISHED="PROCESS_FINISHED",a.RUN_PROCESS="RUN_PROCESS";var e="ws:";"https:"===window.location.protocol&&(e="wss:");var s=e+"//"+window.location.host+o.WEB_ROOT+"/system/websocket";a.ws=new WebSocket(s),a.ws.onmessage=function(t){var e=t.data;if(!jQuery.isEmptyObject(e)){var n=JSON.parse(e);l(n)}};var l=function(t){t.type==a.NOTIFICATION?i.showNotification(t.notification):t.type==a.EVENT?u(t.event):console.error("Unsupported message: "+t)},u=function(t){var e=t.type,n=t.data;if(e==a.PAGE_RELOAD)jQuery.isEmptyObject(n)?setTimeout(function(){window.location.reload()},1e3):0<=window.location.pathname.indexOf("/"+n.name)&&setTimeout(function(){window.location.reload()},1e3);else if(e==a.PROCESS_STARTED){if(!jQuery.isEmptyObject(n)){PubSub.publish(a.PROCESS_STARTED,n);var i=$("#scanDiskNextRun"),s=$("#checkSubNextRun");n.name==o.SCAN_DISK?(i.countdown("stop"),i.text("Running...")):n.name==o.CHECK_SUB&&(s.countdown("stop"),s.text("Running..."))}}else e==a.PROCESS_FINISHED?jQuery.isEmptyObject(n)||(PubSub.publish(a.PROCESS_FINISHED,n),n.name==o.SCAN_DISK?$("#scanDiskNextRun").countdown(n.next_run):n.name==o.CHECK_SUB&&$("#checkSubNextRun").countdown(n.next_run)):console.error("Unsupported event type: "+e)};a.sendWebsocketMessage=function(t){a.ws.send(t)},a.runProcessOnServer=function(t){var e={type:a.EVENT,event:{type:a.RUN_PROCESS,data:{name:t}}};a.sendWebsocketMessage(JSON.stringify(e))};var r=o.vue;r.setPosterPlaceholderUrl=function(t){t.target.src=o.getUrl("/images/poster-placeholder.jpg")},r.styleProgressBar=function(i){$(".vue-simple-progress-bar").each(function(){var t=$(this),e=i;null==e&&(e=parseInt(t.css("width"))/parseInt(t.prev(".vue-simple-progress-text").css("width"))*100),e=Math.round(e);for(var n=100;0<e&&e<n;)n-=5;t.removeClass(function(t,e){return(e.match(/\bprogress-\S+/g)||[]).join(" ")}),t.addClass("progress-"+n)})},$(".navbar .nav a").on("click",function(){$(this).hasClass("run-process")||($(".navbar").find(".nav").find(".active").removeClass("active"),$(this).parent().addClass("active"))});var c="/"+location.pathname.replace(o.WEB_ROOT,"").split("/")[1]+"/";$(".navbar").find(".nav").find("a[href='"+c+"']").closest("li").addClass("active"),$(".navbar .nav a.run-process").on("click",function(t){t.preventDefault();var e=$(this).data("process-name");a.runProcessOnServer(e)}),$("input[type=checkbox][data-toggle=toggle][data-on=Enabled][data-off=Disabled]").on("change",function(){var t=$(this).parent().next("input[type=hidden]").val();t="False"==t?"True":"False",$(this).parent().next("input[type=hidden]").val(t)}),o.keepDropdownsOpen=function(){$(".dropdown .dropdown-menu.keep-open,.dropdown-menu.info-list").on("click",function(t){t.stopPropagation()})},o.keepDropdownsOpen(),o.enablePopovers=function(){$("[data-toggle=popover]").popover(),$(document).on("click",function(t){$('[data-toggle="popover"],[data-original-title]').each(function(){$(this).is(t.target)||0!==$(this).has(t.target).length||0!==$(".popover").has(t.target).length||((($(this).popover("hide").data("bs.popover")||{}).inState||{}).click=!1)})})},o.enablePopovers();var p=new Date;p.setTime($("#scanDiskNextRunTimeMs").val()),$("#scanDiskNextRun").countdown(p,function(t){"00:00:00"==t.strftime(o.TIME_FORMAT)?$(this).text("Running..."):$(this).text(t.strftime(o.TIME_FORMAT))});var d=new Date;d.setTime($("#checkSubNextRunTimeMs").val()),$("#checkSubNextRun").countdown(d,function(t){"00:00:00"==t.strftime(o.TIME_FORMAT)?$(this).text("Running..."):$(this).text(t.strftime(o.TIME_FORMAT))});var f=function(t){$(t).hide();var e=$(t).val().split("\n");$(t).next("div.multi-input-fields").remove(),$(t).after('<div class="multi-input-fields"></div>');for(var n=$(t).next("div.multi-input-fields"),i=0;i<e.length;i++)$(n).append('<div class="input-group"><input type="text" class="form-control input-sm" value="'+e[i]+'"><span class="input-group-addon addon-remove"><i class="fa fa-times" aria-hidden="true"></i></span></div>');$(n).append('<div class="input-group"><input type="text" class="form-control input-sm" placeholder="New value"><span class="input-group-addon addon-add"><i class="fa fa-plus" aria-hidden="true"></i></span></div>')};$("textarea.multi-input").each(function(){f(this)}),$(document).on("click",".multi-input-fields .input-group .addon-add",function(){var t=$(this).parents(".multi-input-fields").siblings(".multi-input"),e=$(t).val().split("\n"),n=$(this).siblings("input").val(),i=e.filter(function(t){return t===n});if(n&&0===i.length){var s=e.concat([n]);$(t).val(s.join("\n")),f(t)}else $(this).siblings("input").val("")}),$(document).on("click",".multi-input-fields .input-group .addon-remove",function(){var t=$(this).parents(".multi-input-fields").siblings(".multi-input"),e=t.val().split("\n"),n=$(this).siblings("input").val(),i=e.filter(function(t){return t!==n});t.val(i.join("\n")),f(t)})}(autosubliminal),$.postJson=function(t,e,n,i){"string"!=typeof e&&(e=JSON.stringify(e)),$.ajax({url:t,type:"post",data:e,dataType:i||"json",contentType:"application/json; charset=utf-8",success:n})},$.putJson=function(t,e,n,i){"string"!=typeof e&&(e=JSON.stringify(e)),$.ajax({url:t,type:"put",data:e,dataType:i||"json",contentType:"application/json; charset=utf-8",success:n})},$.deleteJson=function(t,e,n,i){"string"!=typeof e&&(e=JSON.stringify(e)),$.ajax({url:t,type:"delete",data:e,dataType:i||"json",contentType:"application/json; charset=utf-8",success:n})};