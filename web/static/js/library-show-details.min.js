"use strict";!function(n){PubSub.subscribe(n.settings.LOADED,function(){n.library.checkScannerRunning(),PubSub.subscribe(n.websockets.PROCESS_STARTED,n.library.scannerStartedEventSubscriber),PubSub.subscribe(n.websockets.PROCESS_FINISHED,n.library.scannerFinishedEventSubscriber),window.Vue.component("library-show-details",{data:function(){return{show:null,tvdbUrl:n.TVDB_URL,posterFullSizeUrl:n.getUrl("/artwork/tvdb/poster/fullsize/"),posterThumbnailUrl:n.getUrl("/artwork/tvdb/poster/thumbnail/"),languages:n.LANGUAGES,showSettings:null,showSettingsWantedLanguages:[],selectedEpisodeTvdbId:null,selectedFileLocation:null,selectedFileName:null,selectedHardcodedLanguages:[]}},created:function(){},mounted:function(){this.getShowDetails()},updated:function(){n.keepDropdownsOpen(),n.vue.styleProgressBar(this.showProgressPercentage)},computed:{showProgressPercentage:function(){return this.show.total_subtitles_available/this.show.total_subtitles_wanted*100},showProgressText:function(){return this.show.total_subtitles_available+" of "+this.show.total_subtitles_wanted}},methods:{getShowDetails:function(){var t=this,s=window.location.href.substr(window.location.href.lastIndexOf("/")+1);$(".loading").removeClass("hidden"),$.get(n.getUrl("/api/shows/"+s),function(e){t.show=e,t.showSettings=t.show.settings}).fail(function(e){404==e.status&&$.deleteJson(n.getUrl("/api/shows/"+s),null,function(){var e=n.types.Notification();e.message="Show does not exist anymore and has been removed from the library!",e.type=n.notifications.WARNING,e.sticky=!1,n.notifications.showNotification(e),window.location=n.getUrl("/library/shows")})}).always(function(){$(".loading").addClass("hidden")})},setPosterPlaceholderUrl:n.vue.setPosterPlaceholderUrl,getPlayVideoUrl:n.constructPlayVideoUrl,getLanguages:n.convertToLanguages,getLanguageCodes:n.convertToLanguageCodes,internalLanguagesAvailable:function(e){var t=!1;return(e.hardcoded_languages&&0<e.hardcoded_languages.length||e.embedded_languages&&0<e.embedded_languages.length)&&(t=!0),t},refreshShowDetails:function(e){e.preventDefault();var t=this;$(".refresh-running").removeClass("hidden"),$.putJson(n.getUrl("/api/shows/"+t.show.tvdb_id+"/refresh"),null,function(){t.getShowDetails(),$(".refresh-running").addClass("hidden")})},openSettingsModal:function(e){e.preventDefault();var t=this;t.showSettings=t.show.settings,t.showSettingsWantedLanguages=t.getLanguages(t.show.settings.wanted_languages),$("#settingsModal").modal("show")},openDeleteModal:function(e){e.preventDefault(),$("#deleteModal").modal("show")},openSubtitlesModal:function(e,t,s,n,a){a.preventDefault();var o=this;o.selectedEpisodeTvdbId=n,o.selectedFileLocation=e,o.selectedFileName=t,o.selectedHardcodedLanguages=o.getLanguages(s),$("#subtitlesModal").modal("show")},saveSettings:function(e){e.preventDefault();var t=this,s=t.showSettings;s.wanted_languages=t.getLanguageCodes(t.showSettingsWantedLanguages),$.putJson(n.getUrl("/api/shows/"+t.show.tvdb_id+"/settings"),s,function(){$("#settingsModal").modal("hide"),t.refreshShowDetails(e)})},deleteShow:function(e){e.preventDefault(),$.deleteJson(n.getUrl("/api/shows/"+this.show.tvdb_id),null,function(){$("#deleteModal").modal("hide"),window.location=n.getUrl("/library/shows")})},saveHardcodedSubtitles:function(e){e.preventDefault();var t=this,s={file_location:t.selectedFileLocation,file_name:t.selectedFileName,languages:t.getLanguageCodes(t.selectedHardcodedLanguages)};$.putJson(n.getUrl("/api/shows/"+t.show.tvdb_id+"/subtitles/hardcoded/"+t.selectedEpisodeTvdbId),s,function(){$("#subtitlesModal").modal("hide"),t.getShowDetails()})},addShowPathToVideoPaths:function(e){e.preventDefault();var t=this,s={videoPath:t.show.path};$.putJson(n.getUrl("/api/settings/general/videoPaths"),s,function(){t.getShowDetails()})},getNrOfSubtitles:function(e,t){for(var s=0,n=0;n<e.length;n++)if("subtitle"==e[n].type&&null!=e[n].language&&e[n].language==t)s++;else if("video"==e[n].type){if(null!=e[n].hardcoded_languages)for(var a=0;e[n].hardcoded_languages[a];a++)e[n].hardcoded_languages[a]==t&&s++;if(null!=e[n].embedded_languages)for(var o=0;e[n].embedded_languages[o];o++)e[n].embedded_languages[o]==t&&s++}return s},getNrOfVideos:function(e){for(var t=0,s=0;s<e.length;s++)"video"==e[s].type&&t++;return t}}}),window.Vue.component("multiselect",window.VueMultiselect.default),new window.Vue({el:"#app"})})}(autosubliminal);